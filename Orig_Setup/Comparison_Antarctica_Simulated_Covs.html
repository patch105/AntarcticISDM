<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Charlotte R. Patterson">

<title>Comparison Antarctica Simulated</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Comparison_Antarctica_Simulated_Covs_files/libs/clipboard/clipboard.min.js"></script>
<script src="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/quarto.js"></script>
<script src="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/popper.min.js"></script>
<script src="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/anchor.min.js"></script>
<link href="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Comparison_Antarctica_Simulated_Covs_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Comparison_Antarctica_Simulated_Covs_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Comparison_Antarctica_Simulated_Covs_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Comparison_Antarctica_Simulated_Covs_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Comparison Antarctica Simulated</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Charlotte R. Patterson </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sf"</span>, <span class="st">"terra"</span>, <span class="st">"ggpubr"</span>, <span class="st">"RISDM"</span>, <span class="st">"DescTools"</span>, <span class="st">"spatstat"</span>, <span class="st">"Metrics"</span>, <span class="st">"scoringutils"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(packages, require, <span class="at">character.only =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf
Linking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE
Loading required package: terra
terra 1.7.55

Attaching package: 'terra'

The following object is masked from 'package:tidyr':

    extract

Loading required package: ggpubr

Attaching package: 'ggpubr'

The following object is masked from 'package:terra':

    rotate

Loading required package: RISDM
Loading required package: DescTools</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'DescTools' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat
Loading required package: spatstat.data
Loading required package: spatstat.geom
spatstat.geom 3.2-7

Attaching package: 'spatstat.geom'

The following objects are masked from 'package:ggpubr':

    border, rotate

The following objects are masked from 'package:terra':

    area, delaunay, is.empty, rescale, rotate, shift, where.max,
    where.min

Loading required package: spatstat.random
spatstat.random 3.2-1
Loading required package: spatstat.explore
Loading required package: nlme

Attaching package: 'nlme'

The following object is masked from 'package:dplyr':

    collapse

spatstat.explore 3.2-5
Loading required package: spatstat.model
Loading required package: rpart
spatstat.model 3.2-8
Loading required package: spatstat.linnet
spatstat.linnet 3.1-3

spatstat 3.0-7 
For an introduction to spatstat, type 'beginner' 

Loading required package: Metrics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'Metrics' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Metrics'

The following object is masked from 'package:spatstat.explore':

    auc

Loading required package: scoringutils</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'scoringutils' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Note: scoringutils is currently undergoing major development changes (with an update planned for the first quarter of 2024). We would very much appreciate your opinions and feedback on what should be included in this major update: https://github.com/epiforecasts/scoringutils/discussions/333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-the-occurence-data" class="level1">
<h1>Load the occurence data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>PO <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd,<span class="st">"/output/po_all_no_thin.csv"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(PO) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load presence-absence data for model fitting</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>PA_fit <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd,<span class="st">"/output/pa_a.csv"</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>PA_fit <span class="ot">&lt;-</span> PA_fit <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fl">0.02</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load presence-absence data for model validation</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>PA_val <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd,<span class="st">"/output/pa_b.csv"</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>PA_val <span class="ot">&lt;-</span> PA_val <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fl">0.02</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a raster of the study domain</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>PO_vect <span class="ot">&lt;-</span> <span class="fu">vect</span>(PO, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># PO_vect_buffered &lt;- buffer(PO_vect, width = 0.3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-environmental-covariates" class="level1">
<h1>Load the environmental covariates</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(wd,<span class="st">"/output/covariate.tif"</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(cov) <span class="ot">&lt;-</span> <span class="st">"epsg:3031"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cov) <span class="ot">&lt;-</span> <span class="st">"cov"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="mesh-construction" class="level2">
<h2 class="anchored" data-anchor-id="mesh-construction">Mesh construction</h2>
<p>Initial mesh assessment will be via: 1. Plotting mesh and looking at triangle shapes 2. Checking number of vertices in mesh to estimate computation time 3. Fitting a simple INLA model and viewing the posterior spatial scale of the range parameter</p>
</section>
</section>
<section id="risdm-defaults" class="level1">
<h1>1. RISDM defaults</h1>
<p>Still to be decided is the dep.range parameter, the expected range over which spatial autocorrelation is expected to drop to ~0.1 (near zero). Mostly independent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mesh.default <span class="ot">&lt;-</span> <span class="fu">makeMesh</span>(cov,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">max.n =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">2500</span>), <span class="co"># Default c(500,200)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dep.range =</span> <span class="cn">NULL</span>, <span class="co"># In raster projection units, default is 1/3 diagonal length of raster extent</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">expans.mult =</span> <span class="fl">1.5</span>, <span class="co"># Default, 1.5 x dep.range</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="cn">NULL</span>, <span class="co"># Default c(0.2, 0.5)*dep.range</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="cn">NULL</span>, <span class="co"># Default 0.2*max.edge1</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">offset =</span> <span class="cn">NULL</span>, <span class="co"># Default is dep.range</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">doPlot =</span> <span class="cn">TRUE</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No range of dependence specified (dep.range argument). Assuming that this range is 1/5 of the extent of the raster. Maybe(?) this isn't a good value.  Please check.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No max.edge given. Assuming that the inner max.edge is 1/5 of spatial dependence range (dep.range argument) and outer max.edge is 1/2 spatial dependence range.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No cutoff given. Assuming that points less than min( max.edge) / 5 are considered to be the same.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No offset given. Assuming that the outer domain is approximately an expansion of the inner domain by the amount of a spatial dependence range.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="changing-values-of-dep.range-or-other-parameters-as-need-be" class="level1">
<h1>2. Changing values of dep.range or other parameters as need be</h1>
<section id="checking-mesh-with-risdm-function" class="level2">
<h2 class="anchored" data-anchor-id="checking-mesh-with-risdm-function">Checking mesh with RISDM function</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkMesh</span>(mesh.default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>If mesh is good then inner domain should consist of triangles that are: 
 *Visually quite uniform (Left plot),
 *Be comprised of relatively homogeneously sized triangles (middle plot), and 
 *Be comprised of triangles that are not weirdly shaped (most like equilateral triangles, right plot).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="checking-computation-time-based-on-rule-of-thumb-from-bakka-2017" class="level2">
<h2 class="anchored" data-anchor-id="checking-computation-time-based-on-rule-of-thumb-from-bakka-2017">Checking computation time based on rule of thumb from Bakka (2017)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(mesh.default<span class="sc">$</span>n)<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60081.12</code></pre>
</div>
</div>
</section>
<section id="fitting-a-simple-inla-model-for-mesh-checks" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-simple-inla-model-for-mesh-checks">Fitting a simple INLA model for mesh checks</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m.default$summary.hyperpar$mean # Posterior mean estimate for the range</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-the-mesh-for-boundary-effects" class="level2">
<h2 class="anchored" data-anchor-id="checking-the-mesh-for-boundary-effects">Checking the mesh for boundary effects</h2>
<p>Assessment after model fitting is required to test mesh, to see if boundary effect is avoided that causes variance to be 2x larger at border (Lindgren 2012; Lindgren and Rue 2015).</p>
<p>Do so by plotting the standard deviation of the random effect.</p>
</section>
<section id="model-specification" class="level2">
<h2 class="anchored" data-anchor-id="model-specification">Model specification</h2>
<p>Default is that all covariates are standardised (transformed linearly - subtracting mean and dividing by standard deviation) so covariate will have zero mean and standard deviation of one.</p>
<p>Specification of this formula parallels almost precisely as one would do for any glm-like modelling process – see the details section from ?glm for more information about forms accepted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#linear in variable 1 and 2</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dist.form &lt;- ~0 + var1 + var2</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear with single covariate</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>dist.form <span class="ot">&lt;-</span> <span class="er">~</span><span class="dv">0</span> <span class="sc">+</span> cov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="observation-bias-for-po-data" class="level2">
<h2 class="anchored" data-anchor-id="observation-bias-for-po-data">Observation bias for PO data</h2>
<p>*Note - could try a negative exponential relationship here like sampbias</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bias variable</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bias.form &lt;- ~1 + biasvar</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Intercept only</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>bias.form <span class="ot">&lt;-</span> <span class="er">~</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sampling-artefacts-for-pa-data" class="level2">
<h2 class="anchored" data-anchor-id="sampling-artefacts-for-pa-data">Sampling artefacts for PA data</h2>
<p>*Intercept only at the moment</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intercept only</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>artefact.form <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">PA =</span> <span class="sc">~</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="specifying-priors-for-intercepts-and-covariates" class="level2">
<h2 class="anchored" data-anchor-id="specifying-priors-for-intercepts-and-covariates">Specifying priors for intercepts and covariates</h2>
<p>The priors are specified via the control list argument and describe <em>Gaussian distributions</em>.</p>
<p>The <em>prior.mean</em> is a single scalar giving the prior expectation of <em>all the model’s effects</em>. This includes all intercepts and all covariate effects for all the data types.</p>
<p>Almost always, <em>prior.mean will be zero, indicating that the effect has a priori equal chance of being positive or negative</em>.</p>
<p>The prior variation for the <em>covariate effects</em> are split into two types: those for <em>intercepts</em> and those for <em>covariate effects</em>.</p>
<p>Specified through standard deviation.</p>
<p>By default <em>the sd for the intercepts is very large (1000)</em> and that for the <em>covariate effects is large (10)</em>.</p>
<p>Covariates have been <em>scaled prior to fitting the model</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Default fairly vague priors</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># my.control &lt;- list(coord.names = c("x", "y"),</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                    prior.mean = 0,</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                    int.sd = 1000, # Intercept standard deviation</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                    other.sd = 10) # Covariate effect standard deviation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="specifying-priors-for-grf-parameters" class="level2">
<h2 class="anchored" data-anchor-id="specifying-priors-for-grf-parameters">Specifying priors for GRF parameters</h2>
<p>The specification of the distribution of the random effects depends on two parameters: the standard deviation of the effects, and the spatial range of their dependence.</p>
<p>Both these parameters require a prior distribution to be specified, and RISDM, like INLA, <em>follows Simpson et al.&nbsp;(2017) by using complexity priors</em>. These priors are defined by <em>defining the prior chance that the parameter falls above (for prior standard deviation) or below (for spatial range) specified values</em>.</p>
<p>For the gamba grass example, it may be reasonable that the standard deviation has probability of 0.1 (10% chance) of being above 5. We feel that this is a vague prior for random effects on a log-link scale. Likewise, a vague prior for spatial dependence could be that there is a probability of 0.1 that the range is less than 1km. <em>For Gamba Grass example dep.range = 3km</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>my.control <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">coord.names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior.mean =</span> <span class="dv">0</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">int.sd =</span> <span class="dv">1000</span>, <span class="co"># Intercept standard deviation</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">other.sd =</span> <span class="dv">10</span>, <span class="co"># Covariate effect standard deviation</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior.range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="co"># Prior chance 10% that parameter falls below range of 1km</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior.space.sigma =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">0.1</span>)) <span class="co"># Prior chance 10% that parameter falls above SD of 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="integrated-model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="integrated-model-fitting">Integrated model fitting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m.int <span class="ot">&lt;-</span> <span class="fu">isdm</span>(<span class="at">observationList =</span> <span class="fu">list</span>(<span class="at">POdat =</span> PO,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">PAdat =</span> PA_fit),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">covars =</span> cov,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">mesh =</span> mesh.default,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">responseNames =</span> <span class="fu">c</span>(<span class="at">PO =</span> <span class="cn">NULL</span>, <span class="at">PA =</span> <span class="st">"presence"</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sampleAreaNames =</span> <span class="fu">c</span>(<span class="at">PO =</span> <span class="cn">NULL</span>, <span class="at">PA =</span> <span class="st">"area"</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">distributionFormula =</span> dist.form,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">biasFormula =</span> bias.form,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">artefactFormulas =</span> artefact.form,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">control =</span> my.control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="presence-only-model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="presence-only-model-fitting">Presence-Only model fitting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PO data only</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fm.PO <span class="ot">&lt;-</span> <span class="fu">isdm</span>(<span class="at">observationList =</span> <span class="fu">list</span>(<span class="at">POdat =</span> PO), </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">covars =</span> cov,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">mesh =</span> mesh.default,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">responseNames =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sampleAreaNames =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">distributionFormula =</span> dist.form,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">biasFormula =</span> bias.form,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">artefactFormulas =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">control =</span> my.control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="presence-absence-model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="presence-absence-model-fitting">Presence-Absence model fitting</h2>
<p><em>Note - this one is not working at the moment</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #PA data only</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fm.PA &lt;- isdm(observationList = list(PAdat = PA_fit), </span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#               covars = cov,</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#               mesh = mesh.default,</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#               responseNames = c(PA = "presence"),</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#               sampleAreaNames = c(PA = "area"),</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#               distributionFormula = dist.form,</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#               biasFormula = NULL,</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#               artefactFormulas = artefact.form,</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#               control = my.control)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stack-models-as-a-list" class="level2">
<h2 class="anchored" data-anchor-id="stack-models-as-a-list">Stack Models as a List</h2>
<p><em>Not including PA model as it is not working</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">integrated =</span> m.int,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PO =</span> fm.PO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model diagnostics</h2>
<p>Diagnostic table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(mod.list, <span class="cf">function</span>(x) {<span class="fu">summary</span>(x)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$integrated
$DISTRIBUTION
         mean         sd 0.025quant  0.5quant 0.975quant
cov 0.4650757 0.08952487  0.2761972 0.4694711  0.6289253

$PO_BIAS
                  mean       sd 0.025quant  0.5quant 0.975quant
PO_Intercept -1.114501 0.114509  -1.341406 -1.114621 -0.8868715

$PA_ARTEFACT
                 mean        sd 0.025quant 0.5quant 0.975quant
PA_Intercept 2.663817 0.1559403   2.343137 2.668294   2.958307

$SPATIAL
                              mean         sd 0.025quant   0.5quant 0.975quant
Range for isdm.spat.XXX 43.0363566 5.94063827 33.0743618 42.4611017 56.4038203
Stdev for isdm.spat.XXX  0.7309622 0.04498835  0.6498063  0.7284744  0.8268131

$marg.lik
[1] -71446.21

attr(,"class")
[1] "summary.isdm"

$PO
$DISTRIBUTION
        mean         sd 0.025quant  0.5quant 0.975quant
cov 0.654441 0.09024531    0.47838 0.6536678   0.834944

$PO_BIAS
                  mean        sd 0.025quant  0.5quant 0.975quant
PO_Intercept -1.119605 0.1055752  -1.328638 -1.119586 -0.9106643

$SPATIAL
                              mean         sd 0.025quant   0.5quant 0.975quant
Range for isdm.spat.XXX 41.0107936 5.12083538 32.1027093 40.6132920   52.26754
Stdev for isdm.spat.XXX  0.7141446 0.03915142  0.6422957  0.7123669    0.79650

$marg.lik
[1] -71088.41

attr(,"class")
[1] "summary.isdm"</code></pre>
</div>
</div>
</section>
<section id="residual-plots" class="level2">
<h2 class="anchored" data-anchor-id="residual-plots">Residual Plots</h2>
<p>Interpretation: At lower predicted intensity values the residuals are variable, with more underprediction and overprediction. The residuals aren’t spatially autocorrelated which suggests the random field is working?</p>
<p>Our predicted intensity is quite low.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(mod.list, <span class="cf">function</span>(x) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, <span class="at">nFigRow =</span> <span class="dv">2</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$integrated
NULL

$PO
NULL</code></pre>
</div>
</div>
</section>
<section id="posteriors-of-marginal-effects" class="level2">
<h2 class="anchored" data-anchor-id="posteriors-of-marginal-effects">Posteriors of marginal effects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(mod.list, <span class="cf">function</span>(x) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(x<span class="sc">$</span>mod<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">Range for isdm.spat.XXX</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">"Posterior density"</span>)<span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GRF Range Parameter"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(x<span class="sc">$</span>mod<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">Stdev for isdm.spat.XXX</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">"Posterior density"</span>)<span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GRF Std. Dev Parameter"</span>)  </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$integrated</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$PO</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="prediction" class="level2">
<h2 class="anchored" data-anchor-id="prediction">Prediction</h2>
<p>This method proceeds by taking posterior draws of the parameters, using INLA’s inla.posterior.sample function, and then predicting using the sampled parameters into a user-supplied raster stack. In this routine, the spatial random effects are treated the same as the parameters.</p>
<p>The intensity is the “expected number of individuals within a raster cell at each of the raster’s locations”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run for intensity prediction first</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mod.list)) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  mod.list[[i]]<span class="sc">$</span>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.list[[i]],</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">covars =</span> cov,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">S =</span> <span class="dv">30</span>, </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">intercept.terms =</span> <span class="st">"PO_Intercept"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">type =</span> <span class="st">"intensity"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                             </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mod.list[[i]]<span class="sc">$</span>preds<span class="sc">$</span>field[[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]], <span class="at">nc =</span> <span class="dv">3</span>)                           </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now on probability scale. Probability is a non-linear transformation of the intensity, dependent upon the intercept value chosen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mod.list)) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a> mod.list[[i]]<span class="sc">$</span>preds.probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.list[[i]],</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">covars =</span> cov,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">S =</span> <span class="dv">30</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">intercept.terms =</span> <span class="st">"PO_Intercept"</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"probability"</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                             </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mod.list[[i]]<span class="sc">$</span>preds.probs<span class="sc">$</span>field[[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]], <span class="at">nc =</span> <span class="dv">3</span>)                           </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="now-projecting-values-of-the-random-field-for-plotting" class="level2">
<h2 class="anchored" data-anchor-id="now-projecting-values-of-the-random-field-for-plotting">Now projecting values of the random field for plotting</h2>
<p>Want to plot the mean and the sd of the spatial random effect. Code from: <a href="https://becarioprecario.bitbucket.io/spde-gitbook/ch-intro.html" class="uri">https://becarioprecario.bitbucket.io/spde-gitbook/ch-intro.html</a> (chp 2.4).</p>
<p>Plot it on its own scale (type = “link”)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mod.list)) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  mod.list[[i]]<span class="sc">$</span>preds.GRF <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.list[[i]],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">covars =</span> cov,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">S =</span> <span class="dv">30</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">intercept.terms =</span> <span class="st">"PO_Intercept"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">includeRandom =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">includeFixed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                             </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(mod.list[[i]]<span class="sc">$</span>preds.GRF<span class="sc">$</span>field[[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]], <span class="at">nc =</span> <span class="dv">3</span>)                           </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<ol type="1">
<li>Create a raster layer with a constant value for the habitatArea offset.</li>
<li>Predict, specifying which terms should be included.</li>
<li>Plot</li>
</ol>
<p>To get the response plot, just pulls the median, lower, and upper from the prediction function and then plots their relationship with cov.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a temporary cell area layer</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cov_inter <span class="ot">&lt;-</span> <span class="fu">c</span>(cov, cov[[<span class="dv">1</span>]]) </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cov_inter) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(cov), <span class="st">"tmp.habiArea"</span>) <span class="co"># Rename the new covariate</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(cov_inter<span class="sc">$</span>tmp.habiArea) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>posterior_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(mod.list, <span class="cf">function</span>(x) {</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  interpPreds <span class="ot">&lt;-</span> <span class="fu">predict</span>(x, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">covars=</span>cov_inter,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">habitatArea=</span> <span class="st">"tmp.habiArea"</span>, <span class="at">S=</span><span class="dv">30</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">includeFixed=</span><span class="st">"cov"</span>,<span class="co"># Include fixed effect</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">includeRandom=</span><span class="cn">FALSE</span>, </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type=</span><span class="st">"link"</span>) <span class="co"># Difference is you use type = "link"</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># compile covariate and prediction</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="at">cov =</span> <span class="fu">values</span>(cov<span class="sc">$</span>cov),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">values</span>(interpPreds<span class="sc">$</span>field[[<span class="fu">c</span>(<span class="st">"Median"</span>, <span class="st">"Lower"</span>, <span class="st">"Upper"</span>)]]))) </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> pred.df[<span class="sc">!</span><span class="fu">is.na</span>(pred.df<span class="sc">$</span>cov),]</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> pred.df[<span class="fu">order</span>(pred.df<span class="sc">$</span>cov),]</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(pred.df[,<span class="dv">1</span>], pred.df[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">pch =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"cov"</span>, <span class="at">ylab =</span> <span class="st">"Effect"</span>,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Effect plot for cov"</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>( <span class="at">x=</span><span class="fu">c</span>( pred.df<span class="sc">$</span>cov, <span class="fu">rev</span>( pred.df<span class="sc">$</span>cov)),</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>         <span class="fu">c</span>(pred.df<span class="sc">$</span>Upper, <span class="fu">rev</span>(pred.df<span class="sc">$</span>Lower)),</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="fu">grey</span>(<span class="fl">0.95</span>), <span class="at">bor=</span><span class="cn">NA</span>)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>( pred.df[,<span class="fu">c</span>(<span class="st">"cov"</span>,<span class="st">"Median"</span>)], <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="validate-with-independent-presenceabsence-data" class="level1">
<h1>Validate with independent Presence/Absence data</h1>
<p><strong>First, extract predictions from locations of validation data</strong></p>
<p><strong>Then calculate prediction accuracy with the Brier Score</strong></p>
<p>Using the median posterior prediction of probability of presence per cell. Using the Brier score via the package “DescTools”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imap</span>(mod.list, <span class="cf">function</span>(x, y) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the median prediction for each cell that has validation data</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>val.med <span class="ot">&lt;-</span> <span class="fu">extract</span>(x<span class="sc">$</span>preds.probs<span class="sc">$</span>field<span class="sc">$</span>Median, PA_val[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">xy =</span> T)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the validation data P/A into the dataframe</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>val.med <span class="ot">&lt;-</span> val.med <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">presence =</span> PA_val<span class="sc">$</span>presence)  </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Brier Score for "</span>, y, <span class="st">": "</span>, DescTools<span class="sc">::</span><span class="fu">BrierScore</span>(<span class="at">resp =</span> val.med<span class="sc">$</span>presence,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">pred =</span> val.med<span class="sc">$</span>Median)))</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Brier Score for integrated: 0.115117134096897"
[1] "Brier Score for PO: 0.114830827906386"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$integrated
[1] "Brier Score for integrated: 0.115117134096897"

$PO
[1] "Brier Score for PO: 0.114830827906386"</code></pre>
</div>
</div>
</section>
<section id="validate-with-true-simulated-data" class="level1">
<h1>Validate with ‘true’ simulated data</h1>
<p><strong>First, extract ‘true’ intensity values</strong></p>
<p>Code modified from Simmonds et al.&nbsp;(2020). Will be the intensity of each grid square.</p>
<p>**Note - need to fix so that it’s the median intensity, right now I think it’s the mean</p>
<p><strong>Then calculate prediction accuracy with the correlation, mean absolute error of difference, and root mean square error</strong></p>
<p><strong>Then calculate the Interval Score</strong> Using the posterior’s lower and upper 95% confidence limits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the original intensity values</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>mypath <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="fu">paste0</span>(mypath, <span class="st">"/output/nhpp.rdata"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Access attribute (Lambda) of lg.s object and create Lam </span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>Lam <span class="ot">&lt;-</span> <span class="fu">attr</span>(lg.s, <span class="st">'Lambda'</span>) </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the (v) log intensity values (expected number of points per unit area)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>rf.s <span class="ot">&lt;-</span> <span class="fu">log</span>(Lam<span class="sc">$</span>v)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract abundance values by point for truth</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> rf.s</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(cov), </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">resolution =</span> <span class="fu">res</span>(cov),</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs =</span> <span class="fu">crs</span>(cov)) </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract raster cell coordinates</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">xyFromCell</span>(grid, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(grid))</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with the coordinates</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>grid_expand <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> xy[,<span class="dv">1</span>], <span class="at">y =</span> xy[,<span class="dv">2</span>])</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>grid_expand<span class="sc">$</span>abundance <span class="ot">&lt;-</span> data[<span class="fu">Reduce</span>(<span class="st">'cbind'</span>, <span class="fu">nearest.pixel</span>(</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  grid_expand[,<span class="dv">1</span>], grid_expand[,<span class="dv">2</span>],</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">im</span>(data)))] <span class="co"># Converting to an image pixel so it can be processed by the nearest.pixel function</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>truth_grid <span class="ot">&lt;-</span> <span class="fu">rast</span>(grid_expand, <span class="at">crs =</span> <span class="fu">crs</span>(cov))</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(truth_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imap</span>(mod.list, <span class="cf">function</span>(x, y) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># Pull out the mean intensity prediction for each cell</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>mean.int.pred <span class="ot">&lt;-</span> x<span class="sc">$</span>preds<span class="sc">$</span>field<span class="sc">$</span>Mean</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>differences <span class="ot">&lt;-</span> mean.int.pred <span class="sc">-</span> truth_grid</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(differences)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Metrics from Simmonds et al. </span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the predicted intensity to the true intensity </span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Correlation:"</span>,  <span class="fu">cor</span>(<span class="fu">as.vector</span>(mean.int.pred), <span class="fu">as.vector</span>(truth_grid))))</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"MAE of difference for "</span>, y, <span class="st">": "</span>, <span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">as.vector</span>(differences)))))</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Root Mean Square Error for "</span>, y, <span class="st">": "</span>, Metrics<span class="sc">::</span><span class="fu">rmse</span>(<span class="at">actual =</span> <span class="fu">as.vector</span>(truth_grid), </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">predicted =</span> <span class="fu">as.vector</span>(mean.int.pred)))) </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="do">### Calculating the Interval Score </span><span class="al">###</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the lower and upper bounds of the prediction</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>lower.int.pred <span class="ot">&lt;-</span> x<span class="sc">$</span>preds<span class="sc">$</span>field<span class="sc">$</span>Lower</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>upper.int.pred <span class="ot">&lt;-</span> x<span class="sc">$</span>preds<span class="sc">$</span>field<span class="sc">$</span>Upper</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to calculate a different quantile</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># #Extract posterior samples</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co"># samples &lt;- m.int$preds$cell.samples %&gt;% </span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # Function to calculate x% quantiles of each row</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate_quantiles &lt;- function(row) {</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   quantiles &lt;- quantile(row, c(0.025, 0.975))</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(quantiles)</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # Apply the function to each row of the matrix</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="co"># quantiles_per_row &lt;- t(apply(samples, 1, calculate_quantiles))  </span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>interval_score <span class="ot">&lt;-</span> <span class="fu">interval_score</span>(<span class="at">true_values =</span> <span class="fu">as.vector</span>(truth_grid), </span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lower =</span> <span class="fu">as.vector</span>(lower.int.pred), </span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">upper =</span> <span class="fu">as.vector</span>(upper.int.pred),</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">interval_range =</span> <span class="dv">95</span>,</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weigh =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Sum of Interval Score for "</span>,y, <span class="st">": "</span>, <span class="fu">sum</span>(interval_score)))</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Mean of Interval Score for "</span>, y, <span class="st">": "</span>, <span class="fu">mean</span>(interval_score)))</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(interval_score)</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Correlation:0.793250109232799"
[1] "MAE of difference for integrated: 1.62485337635764"
[1] "Root Mean Square Error for integrated: 1.73375231770304"
[1] "Sum of Interval Score for integrated: 141108.008991409"
[1] "Mean of Interval Score for integrated: 1.56786676657122"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Comparison_Antarctica_Simulated_Covs_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Correlation:0.793282059832717"
[1] "MAE of difference for PO: 1.62627396346221"
[1] "Root Mean Square Error for PO: 1.73477582608214"
[1] "Sum of Interval Score for PO: 141222.931546213"
[1] "Mean of Interval Score for PO: 1.56914368384681"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$integrated
[1] "Mean of Interval Score for integrated: 1.56786676657122"

$PO
[1] "Mean of Interval Score for PO: 1.56914368384681"</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>